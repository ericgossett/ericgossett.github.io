{"componentChunkName":"component---src-templates-project-page-js","path":"/digital-graffiti","result":{"data":{"markdownRemark":{"html":"<p>Digital Graffiti is an AR experience that lets users place tags in their environment to display 3D models. When a user encounters a tag in the wild, this application allows one to view the 3D model associated with that tag in augmented reality. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1c6c89eb04fd24620ae1ab671715beb8/751e3/app.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.98830409356725%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAADU0lEQVQoz0WTf0zUZRzHv//iWGQ4JwlXwKA8WvxIXCS/D7jiBG1oZnlIYmL8YW4MVxZJpYuQEHVrDeYvTM4f6+AExJMY4/hhwtSGhCtZInBweOdxd3AH96tXX75z9WzvPZ/Ps+fz2mfvz/MIuuYB6mrbqfuhje+PaDhVq6Wm6jJVRy+J562cqtPicDjxeNx0d3bT2WGgt7ufvu5efr3Rha75Bi2/tKJpbGLAYEC4d2+EvYVbOd1QQ8/AnzRoOmnW3+FW/30qDh6iU9/H8po2TiF/NZrng54jXLaW8LAQVq8KJmDFCgIDAxEEAbVajWC3m6gsS0ffeQyL3c4VnZbbow8lyNkz9VjnrFJsnJxgQ4yMqDUByENXEhMWxOsvrST25WASo1YTExJAZXkpgtvjZdHjYcHpwjHvwDg1waLLxehfo3QbrjH29x8S0GaZ4dgnKr74IIlDhRsp37GRsu0pfLlLwdfF+Xyl3oLu9I8IfvHywvRD3HazVKi9epyRB0MMDLZT8Wmy6M/x/4A/lW2n4uNMit7fQJ4inp0FSewrSubzfblUlXzI9cZ6hMWlJSZsS1jd4HI6eTwxxsyTGSxzCzwaN2Kx2iWg/amJEwc2o85PIG19DMmxMSgz4snJiGWr8k2+25NLx/mTCC63H1X5MOd1j5kxzVJ7sp6+ni76b/XRcPYcN4cfSEDH01lq9m/i7dRI4l4JZ0eijFKFjPxMOTlpcRwuTKXjXA3CvMvLTb2RRyNG5sSh3P19mPEpE1OTY/w2dI3RsSEJ6LTN8k2JkgT5i8RFytibEsrBrBDSEyLJzZJTXZJGV5MI9Pt9jI/dx2a3suT14/b9Iw7Ji9PtQ0xxe3gGfMJnRRmsi1hFfEQoOdGhqMKDUSZHU7k/hROlSfRqqhG8Pj93BweZnpwUQT5s804czkVJ9gWnJMlDi4nd777F+tdCiI9aS7boX+5Hm0h9I4zDBzKoLo7F8PO3y8/Gh3u5E7Ezt8//TP/HS16fBDSbjGQlRpIQFUTquhfIfi+VnReOisNZwx5VBEcqdtGjb0IYuH2HxistXGq5jkb8Qpeb29Fo28S9Tcq1rXo8Xi9ms5nNWwpIz1CgfEdFTraSnEwFefl5bCvIQ727mAsXL/IvSA2olwUbFewAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"app\"\n        title=\"app\"\n        src=\"/static/1c6c89eb04fd24620ae1ab671715beb8/b9e4f/app.png\"\n        srcset=\"/static/1c6c89eb04fd24620ae1ab671715beb8/cf440/app.png 148w,\n/static/1c6c89eb04fd24620ae1ab671715beb8/d2d38/app.png 295w,\n/static/1c6c89eb04fd24620ae1ab671715beb8/b9e4f/app.png 590w,\n/static/1c6c89eb04fd24620ae1ab671715beb8/f9b6a/app.png 885w,\n/static/1c6c89eb04fd24620ae1ab671715beb8/751e3/app.png 1026w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><strong>Authors</strong>: Eric Gossett, Yunhan Wang and John Bralich.</p>\n<p><strong>Repos</strong>: </p>\n<ul>\n<li><a href=\"https://github.com/ericgossett/digital-graffiti\">iOS App</a></li>\n<li><a href=\"https://github.com/ericgossett/digital-graffiti--backend\">Web Backend</a></li>\n</ul>\n<h1>Web App</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3b35996659c56c6f6d826598fd75ad6b/b3ee8/web.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAIBAwQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAehovgQcT//EABsQAAEEAwAAAAAAAAAAAAAAAAEAAgMQEiEx/9oACAEBAAEFAjIVvBvL/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAACAhMv/aAAgBAQAGPwLRV//EABsQAQACAwEBAAAAAAAAAAAAAAEAESExQZHR/9oACAEBAAE/IQrge/IduV5BWVwK1EGGp//aAAwDAQACAAMAAAAQGP8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Qp//EABwQAQEBAAIDAQAAAAAAAAAAAAERACExQVGhwf/aAAgBAQABPxCuyLKfjO8aFKWnE8DkgU3uJfuAQAejGAl5HEM//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"web\"\n        title=\"web\"\n        src=\"/static/3b35996659c56c6f6d826598fd75ad6b/c739e/web.jpg\"\n        srcset=\"/static/3b35996659c56c6f6d826598fd75ad6b/8ee9c/web.jpg 148w,\n/static/3b35996659c56c6f6d826598fd75ad6b/ebbe7/web.jpg 295w,\n/static/3b35996659c56c6f6d826598fd75ad6b/c739e/web.jpg 590w,\n/static/3b35996659c56c6f6d826598fd75ad6b/5413e/web.jpg 885w,\n/static/3b35996659c56c6f6d826598fd75ad6b/b3ee8/web.jpg 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The Digital Graffiti web application provides the back-end data store for all users and 3D assets used by the mobile application. It consist of a web front-end to preview and upload models as well as REST API endpoints to fetch assets. From here, users will upload their tags and models for use in the mobile app.</p>\n<h3>The Stack</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5afc33140f5cabfd8a0e514334885160/9b1de/stack.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.2089552238806%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAADjUlEQVQ4y31US28bVRSOss0PyP9gl0rdEcSm4rGAqlLUtCy6YJFFlFAoBCRABKSqRqCwwBHE4HRFVaUBN6ELRFEVO86LOqmbiXHtGNszicczk3nPXH89M+N5NGp7pKs799w73/3OOd+5AyDr9XpwmQvWYwjX3gi/n2cv8g+c3nBcxwdPggqCgEqlAp7n0Wg0YFm2728eaXjSUlFrq6jzGkzbxYC3caQIuFlcRE2snWIRMNY0FQfcPvb3H6Ner6PHGLyrHuw0kd+pobjbwD9bDRx19QBQszR8cfdzXF68hMViFpnCAmRDjoANy0FbENFqCxC7gd+luzYeCXhU4cHVOtgs8ziSCDDM2/3Kfbzx4zm8Pf8mzn57Br8UMiFPSJqLrkbpIFoOC3yMvtf3eJS4FspVAcW9dszQsAws7Szh1tZvWH+yjh/+nkOulIuT75qApYKd8HRYjPzrZQnbnI5/Dwzkywo6shEUxXEc2JTo/8Um2t0WRKUDSZUSFWf+cB0bstSFYRjQdAPHXRc39+9hfm8ZJxSBDxgVgCpLVIgtoOjPl4y37nQ6YHTWclwciy6B3cHcw1tQdeA4ZOgZc0kKjg7VZMTO8fPkmUgAnmQ4jvPlExqjSm8fKHj4n4lS1cQmp1JkZgLQNsBUATYlXTfdfjkAWZYhSRIel8voiOIzzDWDUqBaUDSLQrbokl4M2COGjKTiVc9x45BPTlQSsokyAdZq9UjwzE8RS4zAPxAlPpGnZJeYpgnbtvwOOTw89Av4MosAvZx4h73ZG67rJvr52Z8kVQTH72K3tYlSq+jP3rqrduKQvZb6NZuN2CUBQ4GHTZAtfo+p3Hlc/XMMU3/057vnsVBIxYDtdhtfzc6i2Wz6TL1Q/T6XHcjUKbpFemXB2Z/y1/HJg4uYmHsL71w5g/dT5zCzNo702mwQssfGs2q1ipWVVXpVhCifqkHg1MuWafjC9myhcIMAx3Hly9cx+t4rGJ95FZ+uXcJ8/puY4erqKjKZDNLpNFKpFAGv9N8zagFbA1NaYKbiu34uXMdHf43h49/Hcfmz13Bt6SKu0Tqd/5oeBxbkZXR0FIODgxgeHsbQ0BBGRkb6rwqLFdCfs1vf4eq9C/jg9gVM3X4XM3fG8CGtFzZvxIC5XA4TExOYnJzE9PQ0lpeXo444LSVFl3Ag7KHU3MB2fY0qvQGO1rLWjWXzsmc+uf+is6E9Ba8HucUDIrU+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"stack\"\n        title=\"stack\"\n        src=\"/static/5afc33140f5cabfd8a0e514334885160/b9e4f/stack.png\"\n        srcset=\"/static/5afc33140f5cabfd8a0e514334885160/cf440/stack.png 148w,\n/static/5afc33140f5cabfd8a0e514334885160/d2d38/stack.png 295w,\n/static/5afc33140f5cabfd8a0e514334885160/b9e4f/stack.png 590w,\n/static/5afc33140f5cabfd8a0e514334885160/9b1de/stack.png 670w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li><strong>Flask</strong> - Web micro-framework for Python.</li>\n<li><strong>MongoDB</strong> - Document-oriented database.</li>\n<li><strong>Gunicorn</strong> - Python WSGI HTTP server used to host the Flask application. </li>\n<li><strong>NGINX</strong> - The proxy server placed in front of Gunicorn. NGINX handles all incoming request and passes it to Gunicorn. Then it receives the response from Gunicorn and forwards the response to the original client. </li>\n</ul>\n<h3>Other things included (for future development):</h3>\n<ul>\n<li><strong>Celery</strong> - Celery provides a distributed task queue that would allow the web application to run background task. The idea was that we would do some post-processing to the uploaded models in order to make sure there size and origin point were consistent. Instead we opted to only upload models that will not appear to large in the ARKit view.</li>\n<li><strong>Redis</strong> - This would of acted as the broker for Celery.</li>\n</ul>\n<h1>IOS App</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/58e023f5c2f867feff6928c59f0c43ff/24a49/architecture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.42271293375396%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAADpElEQVQ4y5VTWVMjVRTmv/lslVbp+KYP+jTbk5allBsg1syIWi4smcEhYOLMhAQYlpQBMpWBUCwhhF6yAFlIQpLudGJMOiShSX+e2x0UGLDKU/XVOX373u+ec893ukDW1nUkpSL4wywEhvSREZ8HW+NSGWMfM007gfKXjEIli3wlg1K1SGsautjP49YJPh534ubIb7j90GbgrQdDuPHtMN75zoK3WTwwjNf7f8LdUZtBOCNMoHv5PfT5bqJ/5Q66l97FDD9hEtbVKnp/nzQySRXLEFJp+IIhrAsReLeCiGTziFNmW/tJdNunAB0QpW1MR6yY5C2YFkYpHgOX2zAJ1YqMz8ftEDM57OzFEYjuE/ZMRPawKUYhJNPYpZJ7nrigtY6JVGdvBTRVQh1nZhBWpQR6xx4jclRAMLaPl9s7WNsVsBrisCGE4d0MGBexCu49fQatXobe+BPtRgVtVYbeqrGk6Y62Sahkovhw2AJ/NA4unYNnIwD3+hY8m9twLvuwKsbAU/Yv+Ag+GbNBa9aAkzrarTqRqdBPtQ6h3im5mMaIewk9jjn0O+cJCx1v4utJ03/19DmsL9aM0thhnUo2vBG3/yVslrP4P8ZKu87MLitpHBby1OESUtTN5BVIyQoSBRlypWocbFQqUDMZqEdHqOdyULNZNGnNIMyl9/DBz49w66Edtyw23Hlkx/uDVtwmf2NgBG/cH8Sb937Ba18M4IFrgckahYU5FAaHIFmtkEZHkR+ieNFjEqYTArqtNtKaAvEw80+HN8NRrHEiVkI84nkJf4RE3HfOklxUlDkORY8His8HxeuFTHFZEEzCTJzDl2PjOCDC0EECL4O7RMgTmQA/kbNvVvYSF6EM59mroxgMIjc1hYLbbSA3PQ1lZ8ckPIzz+OyxFUm5BD6RwjofNrJjfiscMzx7Wy8fxQ+uGZJMCbJ7HvLwCBS7HcWJCSp/EPLiYifDbBIfWX4FR8I9g3c7hGUaO79AU0IaZOM3sxHE9w4HnThFo35McitSQxUDKqGpqh0dtjT0TS6g59ksekmLvY5ZfOOcw48uJ/ocs8Y30+KnNhee+AOmdK6TjW5K/MIiG9FyrQlJkqA2tCt0qF+LrvMb2h3ipFTFmpDCLo3iqkBaa2oXiC7HlzLUXyGMZUsQY3FUSwX4QzHUGtp/ZvbKpJwvhVlCqsEvZhAQD7ASpilonFz4fzm+NsOzTdXjFo1ZlYReQ7pYg3Z6arTh8r6rMvwbx52aa8kM8qEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"architecture\"\n        title=\"architecture\"\n        src=\"/static/58e023f5c2f867feff6928c59f0c43ff/b9e4f/architecture.png\"\n        srcset=\"/static/58e023f5c2f867feff6928c59f0c43ff/cf440/architecture.png 148w,\n/static/58e023f5c2f867feff6928c59f0c43ff/d2d38/architecture.png 295w,\n/static/58e023f5c2f867feff6928c59f0c43ff/b9e4f/architecture.png 590w,\n/static/58e023f5c2f867feff6928c59f0c43ff/24a49/architecture.png 634w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The Digital Graffiti application consists of two layers the data and presentation layer.</p>\n<h2>The Data Layer</h2>\n<p>The data layer handles fetching 3D assets from the web server, the storage of subscribed users and 3D assets on the device and loading assets into the ARView. It consists of the following:</p>\n<ul>\n<li><strong>APIClient</strong> - Handles all communication with the web server. Includes methods to fetch the list of users and download asset files.</li>\n<li><strong>ModelManager</strong> - Handles storing fetched assets to disk. Also handles loading assets and building SCNodes for the ARKit scene.</li>\n<li><strong>SubscriptionManager</strong> - A singleton which acts as the local store. It contains a list of all subscribed users along with methods to subscribe/unsubscribe.</li>\n</ul>\n<h2>The Presentation Layer</h2>\n<p>The presentation layer consists of 3 views:</p>\n<ul>\n<li><strong>AvailableView</strong> - Displays a grid of cards showing the username and tag. When a card is clicked, the app subscribes to that user.</li>\n<li><strong>SubscriptionView</strong> - Shows a table of all the tags a user subscribed to. From this view one may unsubscribe to a user. </li>\n<li><strong>ARView</strong> - Detects a tag in the wild and displays the associated model if the user subscribed to that tag.</li>\n</ul>\n<h2>Challenges</h2>\n<p>When we first thought of the app we wanted to have 3D locations be determined based on geo-location. So users can tag a location on the map and anyone following the artist could view the 3D model if they are present at that location. However, we learned early on that this was too involved given the alloted time for the class project. </p>\n<p>We decided that a good alternative would be to have the tags be an image that will serve as an anchor point for the 3D model to appear. So, if someone found the tag (image) they can view it in the app and the model will appear. While this should of been straightforward, we found out later on that classifying the images would be a challenge.</p>\n<p> Lastly, very early in the project we decided to store on a server and access them via a REST API. However, we found out that SceneKit wants all the model info to be available when the app is built. So loading models dynamically provided to be another issue. </p>\n<p> Herein I will describe how we overcame these challenges:</p>\n<h3>detecting tags</h3>\n<p> Unfortunately, we encountered the tag issue very late in development. So we had no choice but to come up with a quick solution. While looking for a solution, one of my teammates (John) came up with the idea to use a pre-trained ML model (Inception v3) to handle classifying our tags. Therefore, we can then restrict the tags to the catagories in Inception v3 such that when an image of a category is detected it will display a 3D model of that category (e.g image of a butterfly will show a 3D butterfly). Due to some catagories being similar (cat vs. tabby cat) we check if the classification is in the top 10 to determine wherever or not to show the model. This was done using the new CoreML API as seen in the code below (not written by me):</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">   <span class=\"token comment\">/* this func is used to take the current frame for a machine learning model (inception v3) and perform image recognition. If one of the image recognition result matches a subscribed artist, will display the associated 3d model associated with that artist */</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">performImageRecognition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">// Use current frame as the input of image recognition for the inception v3 model</span>\n   <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> currentFrame <span class=\"token operator\">=</span> sceneView<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>currentFrame <span class=\"token punctuation\">{</span>\n       <span class=\"token builtin\">DispatchQueue</span><span class=\"token punctuation\">.</span><span class=\"token function\">global</span><span class=\"token punctuation\">(</span>qos<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>background<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>async <span class=\"token punctuation\">{</span>\n           <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n               <span class=\"token keyword\">let</span> model <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> <span class=\"token function\">VNCoreMLModel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> <span class=\"token function\">Inceptionv3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">)</span>\n               <span class=\"token keyword\">let</span> request <span class=\"token operator\">=</span> <span class=\"token function\">VNCoreMLRequest</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">:</span> model<span class=\"token punctuation\">,</span> completionHandler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n                   <span class=\"token comment\">// Jump onto the main thread</span>\n                   <span class=\"token builtin\">DispatchQueue</span><span class=\"token punctuation\">.</span>main<span class=\"token punctuation\">.</span>async <span class=\"token punctuation\">{</span>\n                       <span class=\"token comment\">// Access the first result in the array after casting the array as a VNClassificationObservation array</span>\n                       <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> results <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>results <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">VNClassificationObservation</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">let</span> <span class=\"token number\">_</span> <span class=\"token operator\">=</span> results<span class=\"token punctuation\">.</span><span class=\"token builtin\">first</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                           <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>identifiedObject<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> <span class=\"token string\">\"No results?\"</span>\n                           <span class=\"token keyword\">return</span>\n                       <span class=\"token punctuation\">}</span>\n                       <span class=\"token comment\">// Acess the top 10 classes in the array of results from the inception v3 model</span>\n                       <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>subscribedArtists<span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                           <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>subscribedArtists<span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">{</span>\n                               <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">&lt;</span><span class=\"token number\">10</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">// top 10 classes</span>\n                                   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>subscribedArtists<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>artist<span class=\"token punctuation\">.</span>username <span class=\"token operator\">==</span> results<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>identifier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                                       <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>identifiedObject<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> results<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>identifier <span class=\"token comment\">// the label will only change when detected a subscribed artist</span>\n                                       <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">loadCustomModel</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> subscribedArtists<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>artist<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">)</span>\n                                       <span class=\"token keyword\">break</span>\n                                   <span class=\"token punctuation\">}</span>\n                               <span class=\"token punctuation\">}</span>\n                           <span class=\"token punctuation\">}</span>\n                       <span class=\"token punctuation\">}</span>\n                   <span class=\"token punctuation\">}</span>\n               <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n               <span class=\"token keyword\">let</span> handler <span class=\"token operator\">=</span> <span class=\"token function\">VNImageRequestHandler</span><span class=\"token punctuation\">(</span>cvPixelBuffer<span class=\"token punctuation\">:</span> currentFrame<span class=\"token punctuation\">.</span>capturedImage<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n               <span class=\"token keyword\">try</span> handler<span class=\"token punctuation\">.</span><span class=\"token function\">perform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>request<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n           <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n       <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>loading models</h3>\n<p>It was a big concern when we first discovered that 3D assets must be compiled with the app. However, after searching for a solution I encountered a blog post that described how to load 3D assets using the ModelIO API (<a href=\"http://iosdeveloperzone.com/2016/05/10/getting-started-with-modelio/\">link</a>). Using this as an example I created a Model Manager class that handles fetching the models form the web API and preparing them as SCNNodes to load in the AR view. The main functionality of this class takes place in the methods <code class=\"language-text\">saveAssets</code> and <code class=\"language-text\">getSCNNode</code>. The <code class=\"language-text\">saveAssets</code> method fetches the model and texture files from the api and saves them to disk. Once on disk the <code class=\"language-text\">getSCNNode</code> function loads the assets and uses ModelIO to create a SCNNode that can be appended to the Scene in the ARView.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">/*** Fetches 3D assets from the server and stores them on disk.\n    This is used by the subscription manager and is called when a\n    user is subscribed to.\n*/</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">saveAssets</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span><span class=\"token function\">fetchModel</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>modelData<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span><span class=\"token function\">fetchTexture</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> textureData <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">let</span> modelFile <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>assetURL<span class=\"token punctuation\">.</span><span class=\"token function\">appendingPathComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>username<span class=\"token delimiter variable\">)</span></span>_model.obj\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">try</span><span class=\"token operator\">?</span> modelData<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">:</span> modelFile<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>atomic<span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">let</span> textureFile <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>assetURL<span class=\"token punctuation\">.</span><span class=\"token function\">appendingPathComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>username<span class=\"token delimiter variable\">)</span></span>_texture.obj\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">try</span><span class=\"token operator\">?</span> textureData<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">:</span> textureFile<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>atomic<span class=\"token punctuation\">)</span>\n\n            completion<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>modelFile<span class=\"token punctuation\">,</span> textureFile<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/*** Loads the 3D assets and creates a SCNNode which can be appended\n    to the SCNkit scene in the ARView.\n    \n    - First a MDL mesh is created from the .obj file\n    - Next a MDLMaterial is created using the texture file.\n    - Finally, each submesh in the MDL mesh is looped over to apply the\n    material and the SCNode is created.\n*/</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">getSCNNode</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">SCNNode</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> assets <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> <span class=\"token function\">loadAssets</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> username<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> model <span class=\"token operator\">=</span> <span class=\"token function\">MDLAsset</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">:</span> assets<span class=\"token punctuation\">.</span>modelFile<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> object <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span><span class=\"token function\">object</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">MDLMesh</span>\n        <span class=\"token keyword\">let</span> scatteringFunction <span class=\"token operator\">=</span> <span class=\"token function\">MDLScatteringFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">let</span> material <span class=\"token operator\">=</span> <span class=\"token function\">MDLMaterial</span><span class=\"token punctuation\">(</span>\n            name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"baseMaterial\"</span><span class=\"token punctuation\">,</span>\n            scatteringFunction<span class=\"token punctuation\">:</span> scatteringFunction\n        <span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">let</span> matProp <span class=\"token operator\">=</span> <span class=\"token function\">MDLMaterialProperty</span><span class=\"token punctuation\">(</span>\n            name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>username<span class=\"token delimiter variable\">)</span></span>_texture.jpg\"</span><span class=\"token punctuation\">,</span>\n            semantic<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>baseColor<span class=\"token punctuation\">,</span>\n            url<span class=\"token punctuation\">:</span> assets<span class=\"token punctuation\">.</span>textureFile\n        <span class=\"token punctuation\">)</span>\n        material<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span>matProp<span class=\"token punctuation\">)</span>\n    \n        <span class=\"token keyword\">for</span> submesh <span class=\"token keyword\">in</span> object<span class=\"token punctuation\">.</span>submeshes<span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> mesh <span class=\"token operator\">=</span> submesh <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">MDLSubmesh</span> <span class=\"token punctuation\">{</span>\n                mesh<span class=\"token punctuation\">.</span>material <span class=\"token operator\">=</span> material\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">SCNNode</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>mdlObject<span class=\"token punctuation\">:</span> object<span class=\"token punctuation\">)</span>\n\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token builtin\">ModelManagerError</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">AssetFilesNotFound</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"date":"June 29, 2018","path":"/digital-graffiti","title":"Digital Graffiti App","image":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,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","aspectRatio":0.7432885906040269,"src":"/static/2f4f5e9ddcf6dc4ff56ce0a1ad9fac04/88c7f/digitalGraffiti_AR_view.png","srcSet":"/static/2f4f5e9ddcf6dc4ff56ce0a1ad9fac04/d9446/digitalGraffiti_AR_view.png 158w,\n/static/2f4f5e9ddcf6dc4ff56ce0a1ad9fac04/2f6e7/digitalGraffiti_AR_view.png 315w,\n/static/2f4f5e9ddcf6dc4ff56ce0a1ad9fac04/88c7f/digitalGraffiti_AR_view.png 443w","sizes":"(max-width: 443px) 100vw, 443px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}